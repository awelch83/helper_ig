$(()=>{"use strict";const e=[],o={statusDiv:document.getElementById("status"),status_1:document.getElementById("status_1"),status_2:document.getElementById("status_2"),follows_1:$("#follows_1"),followed_by_1:$("#followed_by_1"),follows_2:$("#follows_2"),followed_by_2:$("#followed_by_2"),intersection:$("#intersection")};function t(e){return new Promise(t=>{new FetchUsers({obj:e,myData:e.myData,htmlElements:{follows:$(`#follows_${e.id}`),followed_by:$(`#followed_by_${e.id}`)},updateStatusDiv(t,s){o[`status_${e.id}`].textContent=t,o[`status_${e.id}`].style.color=s||"black"},resolve:t}).fetchInstaUsers()})}function s(e,t,s){o[e].textContent=t,o[e].style.color=s||"black"}function l(t,l,r){clearInterval(t.timerInterval);const n=document.querySelector("#timer");o.intersection.asProgress("finish").asProgress("stop");let a="",u="",c="",_="";var i;l.followed_by_count!==l.followed_by_processed&&(a=`(actually returned ${l.followed_by_processed})`),l.follows_count!==l.follows_processed&&(u=`(actually returned ${l.follows_processed})`),r.followed_by_count!==r.followed_by_processed&&(c=`(actually returned ${r.followed_by_processed})`),r.follows_count!==r.follows_processed&&(_=`(actually returned ${r.follows_processed})`),s("statusDiv",`Completed, spent time - ${n.textContent}, common users - ${e.length}\n      (${t.user_1.userName} follows - ${t.user_1.follows_count}${u}\n        and followed by - ${t.user_1.followed_by_count}${a} &&\n      ${t.user_2.userName} follows - ${t.user_2.follows_count}${_}\n        and followed by - ${t.user_2.followed_by_count}${c}),\n      sent HTTP requests - ${+l.receivedResponses+r.receivedResponses+e.length}`),setTimeout(()=>{document.getElementById("tempUiElements").remove(),o.status_1.remove(),o.status_2.remove()},3e3),function(o,t){$("#jqGrid").jqGrid({pager:"#jqGridPager",datatype:"local",data:e,rowNum:instaDefOptions.gridPageSize,autowidth:!0,height:"100%",rownumbers:!0,colModel:t,viewrecords:!0,loadonce:!0,ignoreCase:!0,caption:`Common Users of ${o.user_1.userName} and ${o.user_2.userName}`}).jqGrid("filterToolbar",{searchOperators:!0,defaultSearch:"cn",searchOnEnter:!1}).jqGrid("navGrid","#jqGridPager",{search:!0,add:!1,edit:!1,del:!1,refresh:!0},{},{},{},{multipleSearch:!0,closeAfterSearch:!0,closeOnEscape:!0,searchOnEnter:!0,showQuery:!0},{}).jqGrid("setGridWidth",$("#jqGrid").width()-20)}(t,function(e){return[{label:"User",name:"profile_pic_url_hd",width:"320",align:"center",sortable:!1,formatter:(e,o,t)=>`<a href='https://www.instagram.com/${t.username}' target='_blank'><img src='${e}' alt='' /></a>`,search:!1},{label:"Info",name:"username",sortable:!1,formatter(e,o,t){let s=`id:${t.id}<br/>username:<strong>${t.username}</strong><br/>`;return s+=t.full_name?`full name:<strong>${t.full_name}</strong><br/>`:"",s+=t.connected_fb_page?`FB:<a href='${t.connected_fb_page}' target='_blank'>${t.connected_fb_page}</a><br/>`:"",s+=t.external_url?`url:<a href='${t.external_url}' target='_blank'>${t.external_url}</a>`:""},cellattr:()=>'style="white-space: normal;"',search:!0,stype:"text",searchoptions:{dataInit(e){$(e).attr("placeholder","<<Filter by username>>")}}},{label:"Bio",name:"biography",sortable:!1,formatter:e=>e||"",cellattr:()=>'style="white-space: normal;"',search:!1},{label:"Follows <br/>you",name:"follows_viewer",width:"80",align:"center",stype:"select",searchoptions:{sopt:["eq"],value:":Any;true:Yes;false:No;null:Requested you"},formatter(e,o,t){const s=t.has_requested_viewer?"ui-state-disabled":"";return`<input type='checkbox'\n          ${t.follows_viewer||t.has_requested_viewer?'checked="checked"':""}\n          class='${s}' value='${t.follows_viewer}' offval='no' disabled='disabled'>`},cellattr:()=>'style="background-color: #fbf9ee;" title="Follows you"',search:!0},{label:"Followed <br>by you",name:"followed_by_viewer",width:"80",align:"center",stype:"select",searchoptions:{sopt:["eq"],value:":Any;true:Yes;false:No;null:Requested by you"},formatter(e,o,t){const s=t.requested_by_viewer?"ui-state-disabled":"";return`<input type='checkbox'\n          ${t.follows_viewer||t.has_requested_viewer?'checked="checked"':""}\n          class='${s}' value='${t.follows_viewer}' offval='no' disabled='disabled'>`},cellattr:()=>'style="background-color: #fbf9ee;" title="Followed by you"',search:!0},{label:`Follows <br/>${e.user_1.userName}`,name:"user_1_followed_by",width:"80",formatter:"checkbox",align:"center",stype:"select",searchoptions:{sopt:["eq"],value:":Any;true:Yes;false:No"},cellattr:()=>`title="Follows ${e.user_1.userName}"`,search:!0},{label:`Followed <br/> by ${e.user_1.userName}`,name:"user_1_follows",width:"80",formatter:"checkbox",align:"center",stype:"select",searchoptions:{sopt:["eq"],value:":Any;true:Yes;false:No"},cellattr:()=>`title="Followed by ${e.user_1.userName}"`,search:!0},{label:`Follows <br/>${e.user_2.userName}`,name:"user_2_followed_by",width:"80",formatter:"checkbox",align:"center",stype:"select",searchoptions:{sopt:["eq"],value:":Any;true:Yes;false:No"},cellattr:()=>`title="Follows ${e.user_2.userName}"`,search:!0},{label:`Followed <br/> by ${e.user_2.userName}`,name:"user_2_follows",width:"80",formatter:"checkbox",align:"center",stype:"select",searchoptions:{sopt:["eq"],value:":Any;true:Yes;false:No"},cellattr:()=>`title="Followed by ${e.user_2.userName}"`,search:!0},{label:"Private",name:"is_private",width:"80",formatter:"checkbox",align:"center",stype:"select",searchoptions:{sopt:["eq"],value:":Any;true:Yes;false:No"},cellattr:()=>'title="Is private"',search:!0},{label:"Followers",name:"followed_by_count",width:"70",align:"center",sorttype:"number",search:!0,searchoptions:{sopt:["ge","le","eq"]},cellattr:()=>'title="Followers"'},{label:"Following",name:"follows_count",width:"70",align:"center",sorttype:"number",search:!0,searchoptions:{sopt:["ge","le","eq"]},cellattr:()=>'title="Following"'},{label:"Posts",name:"media_count",width:"70",align:"center",sorttype:"number",search:!0,searchoptions:{sopt:["ge","le","eq"]},cellattr:()=>'title="Posts"'}]}(t)),i=t,$("#export_XLSX").on("click",()=>{let o="xlsx";const t=document.getElementsByName("outType");for(let e=0;e<t.length;e+=1)if(t[e].checked){o=t[e].value;break}const s=`commonusers_${i.user_1.userName}_and_${i.user_2.userName}_${exportUtils.formatDate(new Date)}.${o}`,l=exportUtils.h1,r=e.map(e=>{const o=Object.keys(e),t={};for(let s=0;s<o.length;s+=1)l.includes(o[s])&&(t[o[s]]=e[o[s]]);return t});if("xlsx"===o){const e=XLSX.utils.book_new();e.Props={Title:"Users Title",Subject:"Users Subject",Author:"Instagram Helper",CreatedDate:new Date},e.SheetNames.push("UsersSheet");const t=XLSX.utils.json_to_sheet(r,{header:l,cellDates:!0});e.Sheets.UsersSheet=t;const n=XLSX.write(e,{bookType:o,type:"binary"});saveAs(new Blob([exportUtils.s2ab(n)],{type:"application/octet-stream"}),s)}else{const e=XLSX.utils.book_new(),o=XLSX.utils.json_to_sheet(r,{header:l});XLSX.utils.book_append_sheet(e,o,"output"),XLSX.writeFile(e,s)}}),$("#exportDiv").show()}chrome.runtime.onMessage.addListener(r=>{if("get_common_users"===r.action){const n=new Date,a=function(e,o){return setInterval(()=>{const t=parseInt(new Date-o);let s=t/1e3;const l=parseInt(s%60,10);s/=60;const r=parseInt(s%60,10);s/=60;const n=parseInt(s%24,10);e.textContent=`${n}h:${"00".substring(0,2-`${r}`.length)+r}m:${"00".substring(0,2-`${l}`.length)+l}s`},1e3)}(document.querySelector("#timer"),new Date);r.timerInterval=a;const u=instaDefOptions.you===r.user_1.userName?instaUserInfo.getUserProfile({username:r.viewerUserName}):r.user_1.userName,c=instaDefOptions.you===r.user_2.userName?instaUserInfo.getUserProfile({username:r.viewerUserName}):r.user_2.userName;Promise.all([u,c]).then(u=>{"object"==typeof u[0]&&(r.user_1.userName=r.viewerUserName,r.user_1.user_is_private=u[0].is_private,r.user_1.follows_count=u[0].follows_count,r.user_1.followed_by_count=u[0].followed_by_count,r.user_1.userId=u[0].id,r.user_1.user_followed_by_viewer=!1),"object"==typeof u[1]&&(r.user_2.userName=r.viewerUserName,r.user_2.user_is_private=u[1].is_private,r.user_2.follows_count=u[1].follows_count,r.user_2.followed_by_count=u[1].followed_by_count,r.user_2.userId=u[1].id,r.user_2.user_followed_by_viewer=!1),function(r,n,a){const u={id:1,request:null,userName:r.user_1.userName,pageSize:r.pageSize,delay:1e3+r.delay,csrfToken:r.csrfToken,userId:r.user_1.userId,relType:"All"===r.relType?r.user_1.follows_count>r.user_1.followed_by_count?"follows":"followed_by":r.relType,callBoth:"All"===r.relType,checkDuplicates:!1,follows_count:r.user_1.follows_count,followed_by_count:r.user_1.followed_by_count,follows_processed:0,followed_by_processed:0,startTime:n,timerInterval:a,myData:[],receivedResponses:0,limit:0},c={id:2,request:null,userName:r.user_2.userName,pageSize:r.pageSize,delay:1e3+r.delay,csrfToken:r.csrfToken,userId:r.user_2.userId,relType:"All"===r.relType?r.user_2.follows_count>r.user_2.followed_by_count?"follows":"followed_by":r.relType,callBoth:"All"===r.relType,checkDuplicates:!1,follows_count:r.user_2.follows_count,followed_by_count:r.user_2.followed_by_count,follows_processed:0,followed_by_processed:0,startTime:n,timerInterval:a,myData:[],receivedResponses:0,limit:0};_=u,i=c,document.getElementById("followed_by_1_title").textContent=`${_.userName} is followed by ${_.followed_by_count} users`,o.followed_by_1.asProgress({namespace:"progress",min:0,max:_.followed_by_count,goal:_.followed_by_count,labelCallback(e){const o=this.getPercentage(e);return`Followed by:${_.followed_by_processed}/${_.followed_by_count}/${o}%`}}),document.getElementById("follows_1_title").textContent=`${_.userName} follows ${_.follows_count} users`,o.follows_1.asProgress({namespace:"progress",min:0,max:_.follows_count,goal:_.follows_count,labelCallback(e){const o=this.getPercentage(e);return`Follows:${_.follows_processed}/${_.follows_count}/${o}%`}}),document.getElementById("followed_by_2_title").textContent=`${i.userName} is followed by ${i.followed_by_count} users`,o.followed_by_2.asProgress({namespace:"progress",min:0,max:i.followed_by_count,goal:i.followed_by_count,labelCallback(e){const o=this.getPercentage(e);return`Followed by:${i.followed_by_processed}/${i.followed_by_count}/${o}%`}}),document.getElementById("follows_2_title").textContent=`${i.userName} follows ${i.follows_count} users`,o.follows_2.asProgress({namespace:"progress",min:0,max:i.follows_count,goal:i.follows_count,labelCallback(e){const o=this.getPercentage(e);return`Follows:${i.follows_processed}/${i.follows_count}/${o}%`}});var _,i;const d=t(u),f=t(c);Promise.all([d,f]).then(t=>{const[n,a]=t;let u=function(e,o){const t=new Date,s=(e,o)=>+e.id-+o.id;e.sort(s),o.sort(s);const l=[];for(;e.length>0&&o.length>0;)if(+e[0].id<+o[0].id)e.shift();else if(+e[0].id>+o[0].id)o.shift();else{const t=e.shift(),s=o.shift();l.push({id:t.id,username:t.username,user_1_followed_by:t.user_followed_by,user_1_follows:t.user_follows,user_2_followed_by:s.user_followed_by,user_2_follows:s.user_follows})}return console.log(`intersect arrays took ${new Date-t}ms`),l}(n.myData,a.myData);u.length>0?(s("statusDiv",`Found common users ${(u=u).length}`),document.getElementById("intersection_title").textContent="Getting the detailed info",o.intersection.asProgress({namespace:"progress",min:0,max:u.length,goal:u.length,labelCallback(e){return`${this.getPercentage(e)}%`}}),function(t){return new Promise(s=>{!function t(s,l,r){instaUserInfo.getUserProfile({username:s[l].username,userId:s[l].id,updateStatusDiv(e,t){o.statusDiv.textContent=e,o.statusDiv.style.color=t||"black"}}).then(n=>{n.user_1_followed_by=s[l].user_1_followed_by,n.user_1_follows=s[l].user_1_follows,n.user_2_followed_by=s[l].user_2_followed_by,n.user_2_follows=s[l].user_2_follows,e.push(n),o.intersection.asProgress("go",l+1),l!==s.length-1?setTimeout(()=>{t(s,++l,r)},0):r()})}(t,0,s)})}(u).then(()=>{l(r,n,a)})):l(r,n,a)});var w}(r,n,a)})}})}),window.onload=function(){_gaq.push(["_trackPageview"])};